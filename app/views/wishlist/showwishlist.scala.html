@(wishlist:Wishlist,wishes:Seq[Wish],addWishForm:Form[String])(implicit flash:Flash, currentRecipient: Option[Recipient])

@import helper._

@nautical(wishlist.title) {
	<li><a href="@routes.WishController.showWishlist(wishlist.recipient.username,wishlist.wishlistId.get)">wishlist</a></li>
}{
	
	<div id="view-wishlist-page">


        @for(error <- addWishForm.errors){
        <p class="alert alert-error">
            @error.message: @error.key
        </p>
        }



        <div class="well" >
		
			<h3>@wishlist.title</h3>
		
			<p>A wishlist for <a href="@routes.RecipientController.showProfile(wishlist.recipient.username)">@wishlist.recipient.username</a></p>

			<p>@wishlist.description</p>


		</div>



		@if(wishes.size>0){

		<div class="well" id="wishlist-wishes">




			<h4>Wishes</h4>

				@for(wish <- wishes){
					<div class="modal hide fade" id="wishModal-@wish.wishId.get" tabindex="-1" role="dialog" aria-labelledby="wishModalLabel-@wish.wishId.get" aria-hidden="true">
                        @if(currentRecipient.isDefined && wishlist.recipient == currentRecipient.get){
                            @form(action = routes.WishController.updateWish(wishlist.recipient.username,wishlist.wishlistId.get,wish.wishId.get), 'class -> "form-inline update-wish-form" ){
                                <input type="hidden" name="wishId" value="@wish.wishId.get"/>
                                <input type="hidden" name="title" value="@wish.title"/>
                                <input type="hidden" name="description" value="@wish.description"/>
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h3 id="wishModalLabel-@wish.wishId.get" class="editable"><span>@wish.title</span> <i class="icon-pencil"></i></h3>
                                </div>
                                <div class="modal-body editable-area">
                                    <p>
                                        <i class="icon-pencil pull-right"></i>
                                        <span>@wish.description</span>
                                    </p>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-small input-small btn-inverse" data-dismiss="modal" aria-hidden="true">cancel</button>
                                    <button class="btn btn-success input-small btn-small" type="submit">update wish</button>
                            }
                            @form(action = routes.WishController.deleteWishFromWishlist(wishlist.recipient.username,wishlist.wishlistId.get,wish.wishId.get), 'class -> "form-inline"){
                                    <button type="submit" class="btn btn-danger input-small btn-small">delete wish</button>
                            }
                                </div>
                        } else {
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h3 id="wishModalLabel-@wish.wishId.get"><span>@wish.title</span></h3>
                          </div>
                          <div class="modal-body">
                                <p>@wish.description</p>
                          </div>
                            <div class="modal-footer">
                                <button class="btn btn-small input-small btn-inverse" data-dismiss="modal" aria-hidden="true">cancel</button>
                            </div>
                        }
					</div>
				}


			<table class="table table-striped">
				<tbody>
					@for(wish <- wishes){
						<tr>
							<td><a href="#wishModal-@wish.wishId.get" role="button" class="" data-toggle="modal">@wish.title</a> &nbsp;&nbsp; <small class="muted">@wish.description</small></td>
						</tr>
					}
				</tbody>
			</table>
		</div>

		}


	@if(currentRecipient.isDefined && wishlist.recipient == currentRecipient.get){
		<div class="well" >
			@form(action = routes.WishController.addWishToWishlist(wishlist.recipient.username,wishlist.wishlistId.get), 'class -> "form-inline"){
				<input type="text" class="input-large" name="title" placeholder="New wish title" value="@addWishForm("title").value"/>
				<button class="btn btn-success input-medium" type="submit">add wish</button>
			}
		</div>



		<div class="well" >
			<div class="control-group">
				<div class="buttons">
					<a class="btn btn-warning input-small" href="@routes.WishController.showEditWishlist(wishlist.recipient.username,wishlist.wishlistId.get)">edit wishlist</a>
				</div>
			</div>
		</div>

        }

	
	</div>

<style>
    .over-inline {
        background-color: #FFFACD;
    }

    body .active-inline {
        background-color: inherit;
    }
</style>
<script type="text/javascript">
    $(document).ready(function(){
        $(".editable, .editable-area")
            .hover(function() {
                $(this).find(':first-child:input').toggleClass("over-inline");
            })
            .click(function(e) {
                var $editableContainer = $(this);
                var $editable = $editableContainer.find('span');
                if($editable.hasClass('active-inline')){
                    return;
                }
                var contents = $.trim($editable.html());
                $editable
                    .addClass("active-inline")
                    .empty();
                var editElement = $editableContainer.hasClass('editable')
                    ? '<input type="text" name="title" class="input-xlarge" ∕>'
                    : '<textarea name="description" class="input-xlarge" rows="4"></textarea>';
                $(editElement)
                    .val(contents)
                    .appendTo($editable)
                    .focus()
                    .blur(function(e) {
                        $editable.trigger('blur');
                    });
            });
        $(".editable span, .editable-area span")
            .blur(function(e) {
                var $editable = $(this);
                var contents = $editable.find(':first-child:input').val();
                $editable
                    .removeClass('active-inline')
                    .contents()
                    .replaceWith(contents);
            });
        $(".modal .update-wish-form")
            .submit(function(e) {
                e.preventDefault();
                var wishId = $('input[name="wishId"]',this).val();
                var title = $.trim($('.modal-header .editable span',this).html());
                var description = $.trim($('.modal-body span',this).html());
                $('input[name="title"]',this).val(title);
                $('input[name="description"]',this).val(description);
                alert($('input[name="title"]',this).val());
                alert($('input[name="description"]',this).val());
            });

    });
</script>



}